<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
<title>Đình Hường ❤ Khánh Linh</title>

<link href="https://fonts.googleapis.com/css2?family=Great+Vibes&display=swap" rel="stylesheet">

<style>
html,body{
margin:0;
padding:0;
background:black;
overflow:hidden;
height:100%;
font-family:'Great Vibes',cursive;
}

canvas{
position:fixed;
top:0;
left:0;
}

</style>
</head>
<body>

<canvas id="canvas"></canvas>

<script>
const canvas=document.getElementById("canvas");
const ctx=canvas.getContext("2d");

let w,h;
function resize(){
w=canvas.width=window.innerWidth;
h=canvas.height=window.innerHeight;
}
resize();
window.onresize=resize;

/* ================= HEART 3D ================= */

let heartParticles=[];
let textParticles=[];
let fireworks=[];
let rotation=0;
let state="forming"; // forming, stable, exploded, text
let slowMotion=false;

function heartShape(t){
let x=16*Math.pow(Math.sin(t),3);
let y=13*Math.cos(t)-5*Math.cos(2*t)-2*Math.cos(3*t)-Math.cos(4*t);
return {x,y:-y};
}

class Particle{
constructor(x,y,size,color){
this.x=x;
this.y=y;
this.size=size;
this.color=color;
this.tx=null;
this.ty=null;
this.opacity=1;
this.sparkle=Math.random()*1000;
this.vx=(Math.random()-0.5)*4;
this.vy=(Math.random()-0.5)*4;
}

update(){
if(this.tx!==null){
this.x+=(this.tx-this.x)*0.05;
this.y+=(this.ty-this.y)*0.05;
}else{
this.x+=this.vx;
this.y+=this.vy;
}
}

draw(){
ctx.globalAlpha=this.opacity*(0.7+Math.sin(Date.now()*0.004+this.sparkle)*0.3);
ctx.fillStyle=this.color;
ctx.font=this.size+"px serif";
ctx.fillText("❤",this.x,this.y);
ctx.globalAlpha=1;
}
}

/* Chaos */
for(let i=0;i<600;i++){
heartParticles.push(new Particle(
Math.random()*w,
Math.random()*h,
Math.random()*18+8,
Math.random()>0.5?"#ff66b2":"#ffffff"
));
}

/* Form 3D Heart */
function formHeart(){
let cx=w/2;
let cy=h/2;
heartParticles.forEach(p=>{
let t=Math.random()*Math.PI*2;
let pos=heartShape(t);

let edge=Math.random();
let scale=edge<0.6?20:15;
p.opacity=edge<0.6?1:0.6;

let depth=Math.cos(rotation);
p.tx=cx+pos.x*scale*depth;
p.ty=cy+pos.y*scale;
});
}

/* Fireworks */
function createFirework(){
let x=Math.random()*w;
let y=Math.random()*h*0.5;
let count=Math.random()*25+20;
for(let i=0;i<count;i++){
let angle=Math.random()*Math.PI*2;
let speed=Math.random()*3+2;
fireworks.push({
x,y,
dx:Math.cos(angle)*speed,
dy:Math.sin(angle)*speed,
life:60,
size:Math.random()*10+6,
color:Math.random()>0.5?"#ff66b2":"#ffffff"
});
}
}

function updateFireworks(){
fireworks.forEach(f=>{
f.x+=f.dx;
f.y+=f.dy;
f.life--;
ctx.globalAlpha=f.life/60;
ctx.fillStyle=f.color;
ctx.font=f.size+"px serif";
ctx.fillText("❤",f.x,f.y);
ctx.globalAlpha=1;
});
fireworks=fireworks.filter(f=>f.life>0);
}

/* EXPLOSION */
function explodeHeart(){
heartParticles.forEach(p=>{
p.tx=null;
p.ty=null;
p.vx=(Math.random()-0.5)*15;
p.vy=(Math.random()-0.5)*15;
});
state="exploded";
}

/* TEXT FORMATION */
function createTextParticles(){
let off=document.createElement("canvas");
let offCtx=off.getContext("2d");
off.width=w;
off.height=h;

offCtx.fillStyle="white";
offCtx.textAlign="center";
offCtx.font="bold 80px 'Great Vibes'";
offCtx.fillText("Đình Hường <3 Khánh Linh",w/2,h/2);

let data=offCtx.getImageData(0,0,w,h).data;

for(let y=0;y<h;y+=6){
for(let x=0;x<w;x+=6){
let index=(y*w+x)*4;
if(data[index+3]>150){
textParticles.push(new Particle(
Math.random()*w,
Math.random()*h,
Math.random()*6+3,
"#ffffff"
));
let p=textParticles[textParticles.length-1];
p.tx=x;
p.ty=y;
}
}
}

state="text";
}

/* CLICK */
canvas.addEventListener("click",()=>{
if(state==="stable"){
explodeHeart();
setTimeout(()=>{
slowMotion=true;
heartParticles.forEach(p=>p.opacity=0.5);
createTextParticles();
},1200);
}
});

/* ANIMATE */
function animate(){
ctx.fillStyle="rgba(0,0,0,0.2)";
ctx.fillRect(0,0,w,h);

rotation+=0.01;

if(state==="forming"||state==="stable"){
formHeart();
}

heartParticles.forEach(p=>{
if(slowMotion){
p.tx=p.tx;
}
p.update();
p.draw();
});

if(state==="text"){
textParticles.forEach(p=>{
p.update();
p.draw();
});
}

updateFireworks();
requestAnimationFrame(animate);
}

/* START */
setTimeout(()=>{state="stable"},2000);
setInterval(createFirework,800);
animate();

</script>
</body>
</html>
