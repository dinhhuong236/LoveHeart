<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>Đình Hường ❤ Khánh Linh</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
html,body{
  margin:0;
  overflow:hidden;
  background:#000;
  font-family:"Segoe UI",sans-serif;
  color:white;
}
canvas{
  position:fixed;
  top:0;left:0;
}
#bg{z-index:1;}
#matrix{
  z-index:2;
  opacity:0.35;
  mix-blend-mode:screen;
  pointer-events:none;
}
#heart{z-index:3;}
#ui{
  position:absolute;
  top:50%;
  left:50%;
  transform:translate(-50%,-50%);
  text-align:center;
  z-index:10;
  pointer-events:none;
}
#title{
  font-size:60px;
  font-weight:bold;
  background:linear-gradient(90deg,#ff4fd8,#fff,#ff0077,#00ffff);
  background-size:300% 300%;
  -webkit-background-clip:text;
  -webkit-text-fill-color:transparent;
  letter-spacing:2px;
  text-shadow:0 0 30px rgba(255,0,150,0.9);
  animation:glow 2s infinite alternate, gradientMove 6s infinite linear;
}
@keyframes glow{
  from{ text-shadow:0 0 15px #ff00aa;}
  to{ text-shadow:0 0 50px #ff66ff,0 0 120px #ff0088;}
}
@keyframes gradientMove{
  0%{background-position:0% 50%;}
  50%{background-position:100% 50%;}
  100%{background-position:0% 50%;}
}
</style>
</head>
<body>

<canvas id="bg"></canvas>
<canvas id="matrix"></canvas>
<canvas id="heart"></canvas>

<div id="ui">
  <div id="title"></div>
</div>

<script>
// ================= TEXT TYPEWRITER =================
const loveText = "Đình Hường ❤ Khánh Linh";
let ti = 0;
const titleEl = document.getElementById("title");
function typeText(){
  if(ti < loveText.length){
    titleEl.innerHTML += loveText[ti++];
    setTimeout(typeText, 120);
  }
}
typeText();

// ================= CANVAS SETUP =================
const bg = document.getElementById("bg");
const heartCanvas = document.getElementById("heart");
const matrixCanvas = document.getElementById("matrix");
const bctx = bg.getContext("2d");
const hctx = heartCanvas.getContext("2d");
const mctx = matrixCanvas.getContext("2d");

function resize(){
  [bg, heartCanvas, matrixCanvas].forEach(c=>{
    c.width = innerWidth;
    c.height = innerHeight;
  });
}
window.onresize = resize;
resize();

// ================= BACKGROUND STARS =================
let stars=[];
for(let i=0;i<400;i++){
  stars.push({x:Math.random()*innerWidth,y:Math.random()*innerHeight,r:Math.random()*2});
}
function drawStars(){
  bctx.clearRect(0,0,bg.width,bg.height);
  stars.forEach(s=>{
    bctx.beginPath();
    bctx.arc(s.x,s.y,s.r,0,Math.PI*2);
    bctx.fillStyle="white";
    bctx.fill();
  });
  requestAnimationFrame(drawStars);
}
drawStars();

// ================= MATRIX ASCII =================
const chars = "01LOVE#@$%&";
const drops = Array(Math.floor(innerWidth/18)).fill(0);
let matrixOpacity = 0.25;

function drawMatrix(){
  mctx.fillStyle = "rgba(0,0,0,0.2)";
  mctx.fillRect(0,0,matrixCanvas.width,matrixCanvas.height);

  mctx.font = "16px monospace";
  mctx.fillStyle = `rgba(0,255,180,${matrixOpacity})`;

  for(let i=0;i<drops.length;i++){
    const text = chars[Math.floor(Math.random()*chars.length)];
    mctx.fillText(text, i*18, drops[i]*18);
    if(drops[i]*18 > matrixCanvas.height && Math.random() > 0.985){
      drops[i]=0;
    }
    drops[i]++;
  }
}
setInterval(drawMatrix,50);

// ================= HEART SHAPE =================
let particles = [];
const heartPoints = [];

function generateHeartPoints(scale=18){
  heartPoints.length=0;
  for(let t=0;t<Math.PI*2;t+=0.018){
    const x = scale*Math.pow(Math.sin(t),3);
    const y = -(scale*(13*Math.cos(t)-5*Math.cos(2*t)-2*Math.cos(3*t)-Math.cos(4*t))/16);
    heartPoints.push({x,y});
  }
}
generateHeartPoints();

// ================= INIT PARTICLES (3D) =================
function initParticles(count=2000){
  particles=[];
  for(let i=0;i<count;i++){
    const p = heartPoints[Math.floor(Math.random()*heartPoints.length)];
    const z = Math.random()*2-1;
    particles.push({
      x: Math.random()*innerWidth,
      y: Math.random()*innerHeight,
      z,
      tx: innerWidth/2 + p.x*16,
      ty: innerHeight/2 + p.y*16,
      tz: z,
      vx:0, vy:0, vz:0,
      size: Math.random()*2.2+1.2,
      hue: 300+Math.random()*80
    });
  }
}
initParticles();

// ================= HEART ENGINE =================
let time=0;
let dissolve=false;
let spiral=false;
let finalMode=false;

function animateHeart(){
  hctx.clearRect(0,0,heartCanvas.width,heartCanvas.height);
  time+=0.01;

  const rotY = Math.sin(time*0.6)*0.35;
  const rotX = Math.cos(time*0.4)*0.2;

  particles.forEach(p=>{
    let dx = p.tx - p.x;
    let dy = p.ty - p.y;
    let dz = p.tz - p.z;

    // dissolve nhưng vẫn giữ hình tim
    if(dissolve){
      dx += Math.sin(time*10 + p.x)*20;
      dy += Math.cos(time*10 + p.y)*20;
    }

    // spiral quanh tim
    if(spiral){
      const angle = Math.atan2(p.ty-innerHeight/2, p.tx-innerWidth/2) + time*0.8;
      const r = Math.hypot(p.tx-innerWidth/2, p.ty-innerHeight/2);
      dx = innerWidth/2 + Math.cos(angle)*r - p.x;
      dy = innerHeight/2 + Math.sin(angle)*r - p.y;
    }

    p.vx += dx*0.0025;
    p.vy += dy*0.0025;
    p.vz += dz*0.002;
    p.vx *= 0.9;
    p.vy *= 0.9;
    p.vz *= 0.9;
    p.x += p.vx;
    p.y += p.vy;
    p.z += p.vz;

    // fake 3D rotation
    let x = p.x-innerWidth/2;
    let y = p.y-innerHeight/2;
    let z = p.z*200;

    const cosY=Math.cos(rotY), sinY=Math.sin(rotY);
    const cosX=Math.cos(rotX), sinX=Math.sin(rotX);

    let xz = x*cosY - z*sinY;
    let zz = x*sinY + z*cosY;
    let yz = y*cosX - zz*sinX;

    const projX = innerWidth/2 + xz;
    const projY = innerHeight/2 + yz;
    const size = p.size*(1+zz/400);

    p.hue = (p.hue + 0.3) % 360;
    const glow = Math.sin(time*3)*0.5+0.5;

    hctx.beginPath();
    hctx.arc(projX, projY, size, 0, Math.PI*2);
    hctx.fillStyle = `hsla(${p.hue},100%,70%,${0.6+glow})`;
    hctx.fill();
  });

  if(finalMode){
    drawFinalHeart();
  }

  requestAnimationFrame(animateHeart);
}
animateHeart();

// ================= FINAL BIG HEART =================
function drawFinalHeart(){
  const cx = innerWidth/2;
  const cy = innerHeight/2;
  const baseR = Math.min(innerWidth, innerHeight)/2.1;

  const grad = hctx.createRadialGradient(cx,cy,baseR*0.1,cx,cy,baseR);
  grad.addColorStop(0,"rgba(255,0,150,0.7)");
  grad.addColorStop(1,"rgba(255,0,150,0)");
  hctx.beginPath();
  hctx.arc(cx,cy,baseR,0,Math.PI*2);
  hctx.fillStyle = grad;
  hctx.fill();

  for(let i=0;i<7;i++){
    const r = baseR + i*35 + Math.sin(time*2+i)*20;
    hctx.beginPath();
    hctx.arc(cx,cy,r,0,Math.PI*2);
    hctx.strokeStyle=`rgba(255,0,200,${0.25-i*0.03})`;
    hctx.lineWidth=2;
    hctx.stroke();
  }
}

// ================= PARALLAX TEXT =================
document.addEventListener("mousemove",e=>{
  const x=(e.clientX/innerWidth-0.5)*30;
  const y=(e.clientY/innerHeight-0.5)*30;
  document.getElementById("ui").style.transform=
    `translate(-50%,-50%) translate(${x}px,${y}px)`;
});

// ================= CINEMATIC TIMELINE =================

// tan rã nhẹ nhưng không mất tim
setInterval(()=>{
  dissolve=true;
  setTimeout(()=>dissolve=false,800);
},15000);

// xoáy
setInterval(()=>{
  spiral=true;
  setTimeout(()=>spiral=false,2000);
},20000);

// hacker → romantic (ascii mờ dần)
setInterval(()=>{
  if(finalMode){
    matrixOpacity -= 0.02;
    if(matrixOpacity < 0.05) matrixOpacity = 0.05;
  }
},2000);

// FINAL HEART MODE
setTimeout(()=>{
  finalMode=true;
  generateHeartPoints(32);
  initParticles(3500);
  titleEl.style.fontSize="72px";
  titleEl.style.textShadow="0 0 70px #ff00ff, 0 0 150px #ff0088";
},22000);

// shockwave click
document.addEventListener("click",e=>{
  particles.forEach(p=>{
    const dx=p.x-e.clientX;
    const dy=p.y-e.clientY;
    const d=Math.hypot(dx,dy)+1;
    p.vx += dx/d*6;
    p.vy += dy/d*6;
  });
});
</script>
</body>
</html>
